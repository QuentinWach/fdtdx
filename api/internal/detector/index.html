<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Yannik Mahlau and Frederik Schubert" /><link rel="canonical" href="https://ymahlau.github.io/fdtdx/api/internal/detector/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Detector Base Class - FDTDX</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../../../stylesheets/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Detector Base Class";
        var mkdocs_page_input_path = "api/internal/detector.md";
        var mkdocs_page_url = "/fdtdx/api/internal/detector/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script>
  <meta name="google-site-verification" content="YRg1ahIy0iLUWtpahY6KK3sAmEVrkXqiqgCi0nI3r5g" />

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../..">
          <img src="../../../img/logo.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../tutorials/jax_introduction/">JAX in FDTDX</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../tutorials/object_placement/">Object Placement</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../tutorials/materials/">Materials Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../tutorials/parameter_mapping/">Fabrication Constraints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../tutorials/interface_compression/">Interface Compression</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../notebooks/modes/">Mode Source and Detector</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../notebooks/simulate_lossy_material/">Lossy materials using conductivity</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" >Public</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../public/apply_params/">fdtdx.apply_params</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/ArrayContainer/">fdtdx.ArrayContainer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/autoinit/">fdtdx.autoinit</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/BinaryMedianFilterModule/">fdtdx.BinaryMedianFilterModule</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/boundary_objects_from_config/">fdtdx.boundary_objects_from_config</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/BoundaryConfig/">fdtdx.BoundaryConfig</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/BrushConstraint2D/">fdtdx.BrushConstraint2D</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/circular_brush/">fdtdx.circular_brush</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/ClosestIndex/">fdtdx.ClosestIndex</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/compute_energy/">fdtdx.compute_energy</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/compute_poynting_flux/">fdtdx.compute_poynting_flux</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/ConnectHolesAndStructures/">fdtdx.ConnectHolesAndStructures</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/constants/">fdtdx.constants</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/Cylinder/">fdtdx.Cylinder</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/Device/">fdtdx.Device</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/DiagonalSymmetry2D/">fdtdx.DiagonalSymmetry2D</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/DtypeConversion/">fdtdx.DtypeConversion</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/EnergyDetector/">fdtdx.EnergyDetector</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/ExtrudedPolygon/">fdtdx.ExtrudedPolygon</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/FieldDetector/">fdtdx.FieldDetector</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/GaussianPlaneSource/">fdtdx.GaussianPlaneSource</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/GaussianPulseProfile/">fdtdx.GaussianPulseProfile</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/GaussianSmoothing2D/">fdtdx.GaussianSmoothing2D</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/GradientConfig/">fdtdx.GradientConfig</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/GridCoordinateConstraint/">fdtdx.GridCoordinateConstraint</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/LinearReconstructEveryK/">fdtdx.LinearReconstructEveryK</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/Logger/">fdtdx.Logger</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/Material/">fdtdx.Material</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/metric_efficiency/">fdtdx.metric_efficiency</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/ModeOverlapDetector/">fdtdx.ModeOverlapDetector</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/ModePlaneSource/">fdtdx.ModePlaneSource</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/ObjectContainer/">fdtdx.ObjectContainer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/ParameterTransformation/">fdtdx.ParameterTransformation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/PerfectlyMatchedLayer/">fdtdx.PerfectlyMatchedLayer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/PeriodicBoundary/">fdtdx.PeriodicBoundary</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/PhasorDetector/">fdtdx.PhasorDetector</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/PillarDiscretization/">fdtdx.PillarDiscretization</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/place_objects/">fdtdx.place_objects</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/plot_setup/">fdtdx.plot_setup</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/PositionConstraint/">fdtdx.PositionConstraint</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/PoyntingFluxDetector/">fdtdx.PoyntingFluxDetector</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/RealCoordinateConstraint/">fdtdx.RealCoordinateConstraint</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/Recorder/">fdtdx.Recorder</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/RecordingState/">fdtdx.RecordingState</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/RemoveFloatingMaterial/">fdtdx.RemoveFloatingMaterial</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/run_fdtd/">fdtdx.run_fdtd</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/SimulationConfig/">fdtdx.SimulationConfig</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/SimulationObject/">fdtdx.SimulationObject</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/SimulationVolume/">fdtdx.SimulationVolume</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/SingleFrequencyProfile/">fdtdx.SingleFrequencyProfile</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/SizeConstraint/">fdtdx.SizeConstraint</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/SizeExtensionConstraint/">fdtdx.SizeExtensionConstraint</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/Sphere/">fdtdx.Sphere</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/StandardToCustomRange/">fdtdx.StandardToCustomRange</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/StandardToPlusOneMinusOneRange/">fdtdx.StandardToPlusOneMinusOneRange</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/SubpixelSmoothedProjection/">fdtdx.SubpixelSmoothedProjection</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/TanhProjection/">fdtdx.TanhProjection</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/TreeClass/">fdtdx.TreeClass</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/typing/">fdtdx.typing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/UniformMaterialObject/">fdtdx.UniformMaterialObject</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/UniformPlaneSource/">fdtdx.UniformPlaneSource</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../public/WaveCharacter/">fdtdx.WaveCharacter</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" >Internal</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../compression/">Compression Base Classes</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Detector Base Class</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#fdtdx.objects.detectors.detector.Detector">Detector</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#fdtdx.objects.detectors.detector.Detector.num_time_steps_recorded">num_time_steps_recorded</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#fdtdx.objects.detectors.detector.Detector.draw_plot">draw_plot</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#fdtdx.objects.detectors.detector.Detector.update">update</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../objects/">Object Base Classes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sources/">Source Base Classes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../transformation/">Parameter Transformation Base Classes</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">FDTDX</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">API Reference</li>
          <li class="breadcrumb-item">Internal</li>
      <li class="breadcrumb-item active">Detector Base Class</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/ymahlau/fdtdx/edit/main/docs/api/internal/detector.md">Edit on ymahlau/fdtdx</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="detector-base-class">Detector Base Class</h1>


<div class="doc doc-object doc-class">



<h2 id="fdtdx.objects.detectors.detector.Detector" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">fdtdx.objects.detectors.detector.Detector</span>


</h2>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="fdtdx.objects.object.SimulationObject" href="../../public/SimulationObject/#fdtdx.SimulationObject">SimulationObject</a></code>, <code><span title="abc.ABC">ABC</span></code></p>


        <p>Base class for electromagnetic field detectors in FDTD simulations.</p>
<p>This class provides core functionality for recording and analyzing electromagnetic field data
during FDTD simulations. It supports flexible timing control, data collection intervals,
and visualization of results.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Attributes:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>dtype</code></b>
                  (<code><span title="jax.numpy.dtype">dtype</span></code>)
              –
              <div class="doc-md-description">
                <p>Data type for detector arrays, defaults to float32.</p>
              </div>
            </li>
            <li>
              <b><code>exact_interpolation</code></b>
                  (<code><span title="bool">bool</span></code>)
              –
              <div class="doc-md-description">
                <p>Whether to use exact field interpolation. Defaults to True.</p>
              </div>
            </li>
            <li>
              <b><code>inverse</code></b>
                  (<code><span title="bool">bool</span></code>)
              –
              <div class="doc-md-description">
                <p>Whether to record fields in inverse time order. Defaults to false.</p>
              </div>
            </li>
            <li>
              <b><code>switch</code></b>
                  (<code><span title="fdtdx.core.switch.OnOffSwitch">OnOffSwitch</span></code>)
              –
              <div class="doc-md-description">
                <p>This switch controls the time steps that the detector is on, i.e. records data.
Defaults to all time steps.</p>
              </div>
            </li>
            <li>
              <b><code>plot</code></b>
                  (<code><span title="bool">bool</span></code>)
              –
              <div class="doc-md-description">
                <p>Whether to generate plots of recorded data. Defaults to true.</p>
              </div>
            </li>
            <li>
              <b><code>if_inverse_plot_backwards</code></b>
                  (<code><span title="bool">bool</span></code>)
              –
              <div class="doc-md-description">
                <p>Plot inverse data in reverse time order.</p>
              </div>
            </li>
            <li>
              <b><code>num_video_workers</code></b>
                  (<code><span title="int">int</span> | None</code>)
              –
              <div class="doc-md-description">
                <p>Number of workers for video generation. If None (default), then no
multiprocessing is used. Note that the combination of multiprocessing and matplotlib is known to produce
problems and can cause the entire system to freeze. It does make the video generation much faster though.</p>
              </div>
            </li>
            <li>
              <b><code>color</code></b>
                  (<code><span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>, <span title="float">float</span>] | None</code>)
              –
              <div class="doc-md-description">
                <p>RGB color for plotting. Defaults to light green.</p>
              </div>
            </li>
            <li>
              <b><code>plot_interpolation</code></b>
                  (<code><span title="str">str</span></code>)
              –
              <div class="doc-md-description">
                <p>Interpolation method for plots. Defualts to "gaussian".</p>
              </div>
            </li>
            <li>
              <b><code>plot_dpi</code></b>
                  (<code><span title="int">int</span> | None</code>)
              –
              <div class="doc-md-description">
                <p>DPI resolution for plots. Defaults to None.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>









  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="fdtdx.objects.detectors.detector.Detector.num_time_steps_recorded" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">num_time_steps_recorded</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>
<div class="doc-signature codehilite"><pre><span></span><code><span class="n">num_time_steps_recorded</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Gets the total number of time steps that will be recorded.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>int</code></b>(                  <code><span title="int">int</span></code>
)              –
              <div class="doc-md-description">
                <p>Number of time steps where detector will record data.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Raises:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="Exception">Exception</span></code>
              –
              <div class="doc-md-description">
                <p>If detector is not yet initialized.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>
    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="fdtdx.objects.detectors.detector.Detector.draw_plot" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">draw_plot</span>


</h3>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">draw_plot</span><span class="p">(</span>
    <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">],</span>
    <span class="n">progress</span><span class="p">:</span> <span class="n">Progress</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Figure</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generates plots or videos from recorded detector data.</p>
<p>Creates visualizations based on dimensionality of recorded data and detector
configuration. Supports 1D line plots, 2D heatmaps, and video generation
for time-varying data.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>state</code></b>
                  (<code><span title="dict">dict</span>[<span title="str">str</span>, <span title="numpy.ndarray">ndarray</span>]</code>)
              –
              <div class="doc-md-description">
                <p>Dictionary containing recorded field data arrays.</p>
              </div>
            </li>
            <li>
              <b><code>progress</code></b>
                  (<code><span title="rich.progress.Progress">Progress</span> | None</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>Optional progress bar for video generation.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="matplotlib.figure.Figure">Figure</span> | <span title="str">str</span>]</code>
              –
              <div class="doc-md-description">
                <p>dict[str, Figure | str]: Dictionary mapping plot names to either
matplotlib Figure objects or paths to generated video files.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/fdtdx/objects/detectors/detector.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">draw_plot</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">progress</span><span class="p">:</span> <span class="n">Progress</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Figure</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generates plots or videos from recorded detector data.</span>

<span class="sd">    Creates visualizations based on dimensionality of recorded data and detector</span>
<span class="sd">    configuration. Supports 1D line plots, 2D heatmaps, and video generation</span>
<span class="sd">    for time-varying data.</span>

<span class="sd">    Args:</span>
<span class="sd">        state (dict[str, np.ndarray]): Dictionary containing recorded field data arrays.</span>
<span class="sd">        progress (Progress | None, optional): Optional progress bar for video generation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict[str, Figure | str]: Dictionary mapping plot names to either</span>
<span class="sd">            matplotlib Figure objects or paths to generated video files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">squeezed_arrs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">squeezed_ndim</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">v_squeezed</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">if_inverse_plot_backwards</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_time_steps_recorded</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">squeezed_arrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_squeezed</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">squeezed_arrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_squeezed</span>
        <span class="k">if</span> <span class="n">squeezed_ndim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">squeezed_ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v_squeezed</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v_squeezed</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="n">squeezed_ndim</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot plot multiple arrays with different ndim&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">squeezed_ndim</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;empty state: </span><span class="si">{</span><span class="n">state</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">figs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">squeezed_ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_time_steps_recorded</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># do line plot</span>
        <span class="n">time_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_on_at_time_step_arr</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">time_steps</span> <span class="o">=</span> <span class="n">time_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">time_step_duration</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">squeezed_arrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_line_over_time</span><span class="p">(</span><span class="n">arr</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">time_steps</span><span class="o">=</span><span class="n">time_steps</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">metric_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">figs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>
    <span class="k">elif</span> <span class="n">squeezed_ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_time_steps_recorded</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">SCALE</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;X axis (μm)&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Y axis (μm)&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Z axis (μm)&quot;</span>
        <span class="k">assert</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;This should never happen&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">squeezed_arrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">spatial_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">/</span> <span class="n">SCALE</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_line_over_time</span><span class="p">(</span>
                <span class="n">arr</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">time_steps</span><span class="o">=</span><span class="n">spatial_axis</span><span class="p">,</span> <span class="n">metric_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span>
            <span class="p">)</span>
            <span class="n">figs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>
    <span class="k">elif</span> <span class="n">squeezed_ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_time_steps_recorded</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># multiple time steps, 1d spatial data - visualize as 2D waterfall plot</span>
        <span class="n">time_steps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_on_at_time_step_arr</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">time_steps</span> <span class="o">=</span> <span class="n">time_steps</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">time_step_duration</span>

        <span class="c1"># Determine spatial axis based on which dimension has size &gt; 1</span>
        <span class="n">SCALE</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># μm per grid point</span>

        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">squeezed_arrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Determine which dimension is spatial (not time)</span>
            <span class="n">spatial_dim</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">spatial_dim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Transpose if needed so time is always first dimension</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">T</span>

            <span class="c1"># Create spatial axis in μm</span>
            <span class="n">spatial_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">SCALE</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_waterfall_over_time</span><span class="p">(</span>
                <span class="n">arr</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
                <span class="n">time_steps</span><span class="o">=</span><span class="n">time_steps</span><span class="p">,</span>
                <span class="n">spatial_steps</span><span class="o">=</span><span class="n">spatial_points</span><span class="p">,</span>
                <span class="n">metric_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">spatial_unit</span><span class="o">=</span><span class="s2">&quot;μm&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">figs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>
    <span class="k">elif</span> <span class="n">squeezed_ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_time_steps_recorded</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># single time step, 2d-plot  # TODO:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">in</span> <span class="n">squeezed_arrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;XY Plane&quot;</span><span class="p">,</span> <span class="s2">&quot;XZ Plane&quot;</span><span class="p">,</span> <span class="s2">&quot;YZ Plane&quot;</span><span class="p">]]):</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_2d_from_slices</span><span class="p">(</span>
                <span class="n">xy_slice</span><span class="o">=</span><span class="n">squeezed_arrs</span><span class="p">[</span><span class="s2">&quot;XY Plane&quot;</span><span class="p">],</span>
                <span class="n">xz_slice</span><span class="o">=</span><span class="n">squeezed_arrs</span><span class="p">[</span><span class="s2">&quot;XZ Plane&quot;</span><span class="p">],</span>
                <span class="n">yz_slice</span><span class="o">=</span><span class="n">squeezed_arrs</span><span class="p">[</span><span class="s2">&quot;YZ Plane&quot;</span><span class="p">],</span>
                <span class="n">resolutions</span><span class="o">=</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">plot_dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dpi</span><span class="p">,</span>
                <span class="n">plot_interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_interpolation</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">figs</span><span class="p">[</span><span class="s2">&quot;sliced_plot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot plot </span><span class="si">{</span><span class="n">squeezed_arrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">squeezed_ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_time_steps_recorded</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># multiple time steps, 2d-plots</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">in</span> <span class="n">squeezed_arrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;XY Plane&quot;</span><span class="p">,</span> <span class="s2">&quot;XZ Plane&quot;</span><span class="p">,</span> <span class="s2">&quot;YZ Plane&quot;</span><span class="p">]]):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">generate_video_from_slices</span><span class="p">(</span>
                <span class="n">plt_fn</span><span class="o">=</span><span class="n">plot_from_slices</span><span class="p">,</span>
                <span class="n">xy_slice</span><span class="o">=</span><span class="n">squeezed_arrs</span><span class="p">[</span><span class="s2">&quot;XY Plane&quot;</span><span class="p">],</span>
                <span class="n">xz_slice</span><span class="o">=</span><span class="n">squeezed_arrs</span><span class="p">[</span><span class="s2">&quot;XZ Plane&quot;</span><span class="p">],</span>
                <span class="n">yz_slice</span><span class="o">=</span><span class="n">squeezed_arrs</span><span class="p">[</span><span class="s2">&quot;YZ Plane&quot;</span><span class="p">],</span>
                <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">,</span>
                <span class="n">num_worker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_video_workers</span><span class="p">,</span>
                <span class="n">resolutions</span><span class="o">=</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">plot_dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dpi</span><span class="p">,</span>
                <span class="n">plot_interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_interpolation</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">figs</span><span class="p">[</span><span class="s2">&quot;sliced_video&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Cannot plot </span><span class="si">{</span><span class="n">squeezed_arrs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Consider setting plot=False for Object </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="si">=}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">squeezed_ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_time_steps_recorded</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># single step, 3d-plot. # TODO: do as mean over planes</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">squeezed_arrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">xy_slice</span> <span class="o">=</span> <span class="n">squeezed_arrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">xz_slice</span> <span class="o">=</span> <span class="n">squeezed_arrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">yz_slice</span> <span class="o">=</span> <span class="n">squeezed_arrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_2d_from_slices</span><span class="p">(</span>
                <span class="n">xy_slice</span><span class="o">=</span><span class="n">xy_slice</span><span class="p">,</span>
                <span class="n">xz_slice</span><span class="o">=</span><span class="n">xz_slice</span><span class="p">,</span>
                <span class="n">yz_slice</span><span class="o">=</span><span class="n">yz_slice</span><span class="p">,</span>
                <span class="n">resolutions</span><span class="o">=</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">plot_dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dpi</span><span class="p">,</span>
                <span class="n">plot_interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_interpolation</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">figs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>
    <span class="k">elif</span> <span class="n">squeezed_ndim</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_time_steps_recorded</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># video with 3d-volume in each time step. plot as slices</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">squeezed_arrs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">xy_slice</span> <span class="o">=</span> <span class="n">squeezed_arrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">xz_slice</span> <span class="o">=</span> <span class="n">squeezed_arrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">yz_slice</span> <span class="o">=</span> <span class="n">squeezed_arrs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">generate_video_from_slices</span><span class="p">(</span>
                <span class="n">plt_fn</span><span class="o">=</span><span class="n">plot_from_slices</span><span class="p">,</span>
                <span class="n">xy_slice</span><span class="o">=</span><span class="n">xy_slice</span><span class="p">,</span>
                <span class="n">xz_slice</span><span class="o">=</span><span class="n">xz_slice</span><span class="p">,</span>
                <span class="n">yz_slice</span><span class="o">=</span><span class="n">yz_slice</span><span class="p">,</span>
                <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">,</span>
                <span class="n">num_worker</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_video_workers</span><span class="p">,</span>
                <span class="n">resolutions</span><span class="o">=</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                <span class="p">),</span>
                <span class="n">plot_dpi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_dpi</span><span class="p">,</span>
                <span class="n">plot_interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_interpolation</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">figs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot plot detector with more than three dimensions&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">figs</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fdtdx.objects.detectors.detector.Detector.update" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">update</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>
<div class="doc-signature codehilite"><pre><span></span><code><span class="nf">update</span><span class="p">(</span>
    <span class="n">time_step</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
    <span class="n">E</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
    <span class="n">H</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">DetectorState</span><span class="p">,</span>
    <span class="n">inv_permittivity</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
    <span class="n">inv_permeability</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DetectorState</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Updates detector state with current field values.</p>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>time_step</code></b>
                  (<code><span title="jax.Array">Array</span></code>)
              –
              <div class="doc-md-description">
                <p>Current simulation time step.</p>
              </div>
            </li>
            <li>
              <b><code>E</code></b>
                  (<code><span title="jax.Array">Array</span></code>)
              –
              <div class="doc-md-description">
                <p>Electric field array.</p>
              </div>
            </li>
            <li>
              <b><code>H</code></b>
                  (<code><span title="jax.Array">Array</span></code>)
              –
              <div class="doc-md-description">
                <p>Magnetic field array.</p>
              </div>
            </li>
            <li>
              <b><code>state</code></b>
                  (<code><span title="fdtdx.objects.detectors.detector.DetectorState">DetectorState</span></code>)
              –
              <div class="doc-md-description">
                <p>Current detector state.</p>
              </div>
            </li>
            <li>
              <b><code>inv_permittivity</code></b>
                  (<code><span title="jax.Array">Array</span></code>)
              –
              <div class="doc-md-description">
                <p>Inverse permittivity array.</p>
              </div>
            </li>
            <li>
              <b><code>inv_permeability</code></b>
                  (<code><span title="jax.Array">Array</span> | <span title="float">float</span></code>)
              –
              <div class="doc-md-description">
                <p>Inverse permeability array.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Returns:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
<b><code>DetectorState</code></b>(                  <code><span title="fdtdx.objects.detectors.detector.DetectorState">DetectorState</span></code>
)              –
              <div class="doc-md-description">
                <p>Updated detector state.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>

            <details class="quote">
              <summary>Source code in <code>src/fdtdx/objects/detectors/detector.py</code></summary>
              <div class="codehilite"><table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">time_step</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
    <span class="n">E</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
    <span class="n">H</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
    <span class="n">state</span><span class="p">:</span> <span class="n">DetectorState</span><span class="p">,</span>
    <span class="n">inv_permittivity</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">,</span>
    <span class="n">inv_permeability</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span> <span class="o">|</span> <span class="nb">float</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DetectorState</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates detector state with current field values.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_step (jax.Array): Current simulation time step.</span>
<span class="sd">        E (jax.Array): Electric field array.</span>
<span class="sd">        H (jax.Array): Magnetic field array.</span>
<span class="sd">        state (DetectorState): Current detector state.</span>
<span class="sd">        inv_permittivity (jax.Array): Inverse permittivity array.</span>
<span class="sd">        inv_permeability (jax.Array | float): Inverse permeability array.</span>

<span class="sd">    Returns:</span>
<span class="sd">        DetectorState: Updated detector state.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">del</span> <span class="p">(</span>
        <span class="n">time_step</span><span class="p">,</span>
        <span class="n">E</span><span class="p">,</span>
        <span class="n">H</span><span class="p">,</span>
        <span class="n">state</span><span class="p">,</span>
        <span class="n">inv_permittivity</span><span class="p">,</span>
        <span class="n">inv_permeability</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../compression/" class="btn btn-neutral float-left" title="Compression Base Classes"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../objects/" class="btn btn-neutral float-right" title="Object Base Classes">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Maintained by Yannik Mahlau</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ymahlau/fdtdx" class="fa fa-code-fork" style="color: #fcfcfc"> ymahlau/fdtdx</a>
        </span>
    
    
      <span><a href="../compression/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../objects/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../javascripts/mathjax.js"></script>
      <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
