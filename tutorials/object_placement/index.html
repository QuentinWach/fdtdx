<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Yannik Mahlau and Frederik Schubert" /><link rel="canonical" href="https://ymahlau.github.io/fdtdx/tutorials/object_placement/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Object Placement - FDTDX</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../../stylesheets/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Object Placement";
        var mkdocs_page_input_path = "tutorials/object_placement.md";
        var mkdocs_page_url = "/fdtdx/tutorials/object_placement/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../..">
          <img src="../../img/logo.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Tutorials</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../jax_introduction/">JAX in FDTDX</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Object Placement</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#basic-positioning">Basic Positioning</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#size-configuration">Size Configuration</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#size-in-grid-units">Size in grid units</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#combination-of-grid-and-metrical-units">Combination of grid and metrical units</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#undefined-sizes-can-be-useful">Undefined Sizes can be useful</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#relative-sizing-constraint">Relative Sizing constraint</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#extending-objects-to-other-objects-or-simulation-boundaries">Extending objects to other objects or Simulation boundaries</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../materials/">Materials Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../parameter_mapping/">Fabrication Constraints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../interface_compression/">Interface Compression</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">API Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Public</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/apply_params/">fdtdx.apply_params</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/ArrayContainer/">fdtdx.ArrayContainer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/autoinit/">fdtdx.autoinit</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/BinaryMedianFilterModule/">fdtdx.BinaryMedianFilterModule</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/boundary_objects_from_config/">fdtdx.boundary_objects_from_config</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/BoundaryConfig/">fdtdx.BoundaryConfig</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/BrushConstraint2D/">fdtdx.BrushConstraint2D</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/circular_brush/">fdtdx.circular_brush</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/ClosestIndex/">fdtdx.ClosestIndex</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/compute_energy/">fdtdx.compute_energy</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/compute_poynting_flux/">fdtdx.compute_poynting_flux</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/ConnectHolesAndStructures/">fdtdx.ConnectHolesAndStructures</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/constants/">fdtdx.constants</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/Cylinder/">fdtdx.Cylinder</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/Device/">fdtdx.Device</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/DiagonalSymmetry2D/">fdtdx.DiagonalSymmetry2D</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/DtypeConversion/">fdtdx.DtypeConversion</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/EnergyDetector/">fdtdx.EnergyDetector</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/ExtrudedPolygon/">fdtdx.ExtrudedPolygon</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/FieldDetector/">fdtdx.FieldDetector</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/GaussianPlaneSource/">fdtdx.GaussianPlaneSource</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/GaussianPulseProfile/">fdtdx.GaussianPulseProfile</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/GaussianSmoothing2D/">fdtdx.GaussianSmoothing2D</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/GradientConfig/">fdtdx.GradientConfig</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/GridCoordinateConstraint/">fdtdx.GridCoordinateConstraint</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/LinearReconstructEveryK/">fdtdx.LinearReconstructEveryK</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/Logger/">fdtdx.Logger</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/Material/">fdtdx.Material</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/metric_efficiency/">fdtdx.metric_efficiency</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/ModeOverlapDetector/">fdtdx.ModeOverlapDetector</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/ModePlaneSource/">fdtdx.ModePlaneSource</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/ObjectContainer/">fdtdx.ObjectContainer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/ParameterTransformation/">fdtdx.ParameterTransformation</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/PerfectlyMatchedLayer/">fdtdx.PerfectlyMatchedLayer</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/PeriodicBoundary/">fdtdx.PeriodicBoundary</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/PhasorDetector/">fdtdx.PhasorDetector</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/PillarDiscretization/">fdtdx.PillarDiscretization</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/place_objects/">fdtdx.place_objects</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/plot_setup/">fdtdx.plot_setup</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/PositionConstraint/">fdtdx.PositionConstraint</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/PoyntingFluxDetector/">fdtdx.PoyntingFluxDetector</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/RealCoordinateConstraint/">fdtdx.RealCoordinateConstraint</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/Recorder/">fdtdx.Recorder</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/RecordingState/">fdtdx.RecordingState</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/RemoveFloatingMaterial/">fdtdx.RemoveFloatingMaterial</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/run_fdtd/">fdtdx.run_fdtd</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/SimulationConfig/">fdtdx.SimulationConfig</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/SimulationObject/">fdtdx.SimulationObject</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/SimulationVolume/">fdtdx.SimulationVolume</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/SingleFrequencyProfile/">fdtdx.SingleFrequencyProfile</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/SizeConstraint/">fdtdx.SizeConstraint</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/SizeExtensionConstraint/">fdtdx.SizeExtensionConstraint</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/Sphere/">fdtdx.Sphere</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/StandardToCustomRange/">fdtdx.StandardToCustomRange</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/StandardToPlusOneMinusOneRange/">fdtdx.StandardToPlusOneMinusOneRange</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/SubpixelSmoothedProjection/">fdtdx.SubpixelSmoothedProjection</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/TanhProjection/">fdtdx.TanhProjection</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/TreeClass/">fdtdx.TreeClass</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/typing/">fdtdx.typing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/UniformMaterialObject/">fdtdx.UniformMaterialObject</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/UniformPlaneSource/">fdtdx.UniformPlaneSource</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/public/WaveCharacter/">fdtdx.WaveCharacter</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Internal</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../api/internal/compression/">Compression Base Classes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/internal/detector/">Detector Base Class</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/internal/objects/">Object Base Classes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/internal/sources/">Source Base Classes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../api/internal/transformation/">Parameter Transformation Base Classes</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">FDTDX</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Tutorials</li>
      <li class="breadcrumb-item active">Object Placement</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/ymahlau/fdtdx/edit/main/docs/tutorials/object_placement.md">Edit on ymahlau/fdtdx</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="object-placement-guide">Object Placement Guide</h1>
<p>This guide explains how to position objects in a simulation scene in FDTDX. The basic workflow looks like this:
1. Define a Simulation volume
2. Define objects and sizing/placement constraints between objects
3. Compute the actual position of objects in the simulation scene by using the place_objects function
4. Optional, but recommend: Plot the simulation scene using plot_setup()
5. Run a simulation</p>
<h2 id="basic-positioning">Basic Positioning</h2>
<p>In FDTDX, objects are positioned either directly or relation to other objects through constraints. </p>
<p>The first step should always be to define the size of the simulation volume. 
FDTDX always uses metrical units, i.e. meters or grid positions referring to the Yee-grid,
 which depends on the resolution used.
<div class="highlight"><pre><span></span><code><span class="c1"># create a simulation config</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">SimulationConfig</span><span class="p">(</span>
    <span class="n">time</span><span class="o">=</span><span class="mf">200e-15</span><span class="p">,</span>
    <span class="n">resolution</span><span class="o">=</span><span class="mf">100e-9</span>
<span class="p">)</span>
<span class="c1"># Create a simulation volume</span>
<span class="n">volume</span> <span class="o">=</span> <span class="n">SimulationVolume</span><span class="p">(</span>
    <span class="n">partial_real_shape</span><span class="o">=</span><span class="p">(</span><span class="mf">4e-6</span><span class="p">,</span> <span class="mf">4e-6</span><span class="p">,</span> <span class="mf">1.5e-6</span><span class="p">),</span>
<span class="p">)</span>
</code></pre></div></p>
<p>We can already use the place_objects and plot_setup function to see the simulation volume.
<div class="highlight"><pre><span></span><code><span class="n">key</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># random key</span>
<span class="c1"># place objects and resolve constraints</span>
<span class="n">objects</span><span class="p">,</span> <span class="n">arrays</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">config</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">place_objects</span><span class="p">(</span>
    <span class="n">volume</span><span class="o">=</span><span class="n">volume</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
    <span class="n">constraints</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># plot the simulation scene</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plot_setup</span><span class="p">(</span>
    <span class="n">config</span><span class="o">=</span><span class="n">config</span><span class="p">,</span>
    <span class="n">objects</span><span class="o">=</span><span class="n">objects</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;empty_scene.png&quot;</span><span class="p">)</span>
</code></pre></div></p>
<p><img alt="image" src="../../img/setup_0.png" /></p>
<p>Now, we can start to position some objects in the simulation scene. 
We start with a substrate at the bottom of simulation. 
To this end, we specify a constraint that aligns the objects in the z-axis (axis 2).
The user should specify these constraints and collect them in a list.</p>
<p>Positional constraints define an anchor point for both objects, which are constrainted to be at the same position. 
The position of the anchor point can be specified in a relative coordinate system of each object. 
A relative coordinate system means that a position of -1 would place the anchor at the left boundary of the object, 
a position of 0 at the middle and a position of 1 at the right boundary.</p>
<p>In case of the substrate, we want the lower boundary of the substrate to be aligned with the lower boundary of the simulation volume. 
This ensures that the substrate is placed exactly at the bottom of the simulation.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># create list of constraints</span>
<span class="n">placement_constraints</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1"># create substrate</span>
<span class="n">substrate</span> <span class="o">=</span> <span class="n">UniformMaterialObject</span><span class="p">(</span>
    <span class="n">partial_real_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.6e-6</span><span class="p">),</span>
    <span class="n">material</span><span class="o">=</span><span class="n">Material</span><span class="p">(</span><span class="n">permittivity</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">relative_permittivity_silica</span><span class="p">),</span>
<span class="p">)</span>
<span class="c1"># place at the bottom of simulation volume</span>
<span class="n">constraint</span> <span class="o">=</span> <span class="n">substrate</span><span class="o">.</span><span class="n">place_relative_to</span><span class="p">(</span>
    <span class="n">volume</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">own_positions</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">other_positions</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">margins</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">grid_margins</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">placement_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constraint</span><span class="p">)</span>
</code></pre></div>
<p>The margins and grid_margins arguments are optional and would allow to speficy a fixed distance between 
the anchor points. The margins argument is in units of meters, the grid margins in units of yee-grid cells. Plotting this again results in</p>
<p><img alt="image" src="../../img/setup_1.png" /></p>
<p>There exist a number of useful shorthands for rapid placements. Some of them are listed below that place 
a cube in the scene. The name and colors argument are only used for plotting.</p>
<p><div class="highlight"><pre><span></span><code><span class="c1"># place an object on top (z-axis / 2) of another object</span>
<span class="n">cube1</span> <span class="o">=</span> <span class="n">UniformMaterialObject</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cube&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">GREEN</span><span class="p">,</span>
    <span class="n">partial_real_shape</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5e-6</span><span class="p">,</span> <span class="mf">0.5e-6</span><span class="p">,</span> <span class="mf">0.5e-6</span><span class="p">),</span>
    <span class="n">material</span><span class="o">=</span><span class="n">Material</span><span class="p">(</span><span class="n">permittivity</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">relative_permittivity_silicon</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">placement_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">cube1</span><span class="o">.</span><span class="n">place_above</span><span class="p">(</span><span class="n">substrate</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># place an object at the center of another object</span>
<span class="n">placement_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">cube1</span><span class="o">.</span><span class="n">place_at_center</span><span class="p">(</span>
        <span class="n">substrate</span><span class="p">,</span>
        <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<img alt="image" src="../../img/setup_2.png" /></p>
<h2 id="size-configuration">Size Configuration</h2>
<p>Object sizes can be specified in a number of ways. 
Firstly, one can directly set the size of an object in the init method.
This can either be a specified in Yee-grid cells or metrical units (meter).</p>
<p><div class="highlight"><pre><span></span><code><span class="c1"># size in meters</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">UniformMaterialObject</span><span class="p">(</span>
    <span class="n">partial_real_shape</span><span class="o">=</span><span class="p">(</span><span class="mf">0.3e-6</span><span class="p">,</span> <span class="mf">1.0e-6</span><span class="p">,</span> <span class="mf">0.7e-6</span><span class="p">),</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>
<img alt="image" src="../../img/setup_3.png" /></p>
<h3 id="size-in-grid-units">Size in grid units</h3>
<p><div class="highlight"><pre><span></span><code><span class="c1"># size in grid units (each 100nm as defined in config above)</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">UniformMaterialObject</span><span class="p">(</span>
    <span class="n">partial_grid_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>
<img alt="image" src="../../img/setup_4.png" /></p>
<h3 id="combination-of-grid-and-metrical-units">Combination of grid and metrical units</h3>
<p><div class="highlight"><pre><span></span><code><span class="c1"># partial combination</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">UniformMaterialObject</span><span class="p">(</span>
    <span class="n">partial_real_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">0.5e-6</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">partial_grid_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="o">...</span>
<span class="p">)</span>
</code></pre></div>
<img alt="image" src="../../img/setup_5.png" /></p>
<h3 id="undefined-sizes-can-be-useful">Undefined Sizes can be useful</h3>
<p>If the size of an object is only partially defined and does not have any constraints,
the size is set to the size of the simulation volume in the respective axis. We actually already used this behavior to define the substrate above.</p>
<p><div class="highlight"><pre><span></span><code><span class="c1"># z-axis is undefined, size is extended to simulation size</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">UniformMaterialObject</span><span class="p">(</span>
    <span class="n">partial_real_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">0.5e-6</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="n">partial_grid_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
    <span class="o">...</span>
<span class="p">)</span>
<span class="c1"># This now results in an error:</span>
<span class="n">placement_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">cube1</span><span class="o">.</span><span class="n">place_above</span><span class="p">(</span><span class="n">substrate</span><span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
Using this specification for the cube, we get the following error:
<div class="highlight"><pre><span></span><code>Exception: Inconsisten grid shape (may be due to extension to infinity) at lower bound: 0 != 6 for axis=2, cube (&lt;class &#39;fdtdx.objects.material.UniformMaterialObject&#39;&gt;). Object has a position constraint that puts the lower boundary at 6, but the lower bound was alreay computed to be at 0. This could be due to a missing size constraint/specification, which resulted in an expansion of the object to the simulation boundary (default size) or another constraint on this object.
</code></pre></div>
The error occurs, because we tried to place the cube above the substrate, which is no longer possible if the z-size of the cube is the whole simulation size. When we remove the problematic placement constraint, we get the correct simulation scene.
<img alt="image" src="../../img/setup_6.png" /></p>
<h2 id="relative-sizing-constraint">Relative Sizing constraint</h2>
<p>The size of an object can also be set in relation to another object. To demonstrate this, we define a second cube, which should be placed above the substrate and have a 200nm distance to the other cube in the x-axis.
<div class="highlight"><pre><span></span><code><span class="n">cube2</span> <span class="o">=</span> <span class="n">UniformMaterialObject</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cube2&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">GREEN</span><span class="p">,</span>
    <span class="n">partial_real_shape</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5e-6</span><span class="p">,</span> <span class="mf">0.5e-6</span><span class="p">,</span> <span class="mf">0.5e-6</span><span class="p">),</span>
    <span class="n">material</span><span class="o">=</span><span class="n">Material</span><span class="p">(</span><span class="n">permittivity</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">relative_permittivity_silicon</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">placement_constraints</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
    <span class="n">cube2</span><span class="o">.</span><span class="n">place_above</span><span class="p">(</span><span class="n">substrate</span><span class="p">),</span>
    <span class="n">cube2</span><span class="o">.</span><span class="n">place_relative_to</span><span class="p">(</span>
        <span class="n">cube1</span><span class="p">,</span>
        <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">own_positions</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">other_positions</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">margins</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">200e-9</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">])</span>
</code></pre></div>
<img alt="image" src="../../img/setup_7.png" /></p>
<p>Now let's change the size definition of the second cube to a relative size constraint, which defines the y-size of the second cube as the size of the first cube in the z-axis.
<div class="highlight"><pre><span></span><code><span class="n">cube2</span> <span class="o">=</span> <span class="n">UniformMaterialObject</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cube2&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">GREEN</span><span class="p">,</span>
    <span class="n">partial_real_shape</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5e-6</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">0.5e-6</span><span class="p">),</span>
    <span class="n">material</span><span class="o">=</span><span class="n">Material</span><span class="p">(</span><span class="n">permittivity</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">relative_permittivity_silicon</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">placement_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">cube2</span><span class="o">.</span><span class="n">size_relative_to</span><span class="p">(</span>
        <span class="n">cube1</span><span class="p">,</span>
        <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">other_axes</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">proportions</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div>
<img alt="image" src="../../img/setup_8.png" /></p>
<p>Another useful convenience wrapper is the following:
<div class="highlight"><pre><span></span><code><span class="n">object1</span><span class="o">.</span><span class="n">same_size</span><span class="p">(</span><span class="n">object2</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div></p>
<h2 id="extending-objects-to-other-objects-or-simulation-boundaries">Extending objects to other objects or Simulation boundaries</h2>
<p>The last method to set the size of an object is to constrain the size, such that it extends up to another object in the simulation scene.</p>
<p><div class="highlight"><pre><span></span><code><span class="c1"># definition of first cube</span>
<span class="n">cube1</span> <span class="o">=</span> <span class="n">UniformMaterialObject</span><span class="p">(</span>
    <span class="n">partial_real_shape</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5e-6</span><span class="p">,</span> <span class="mf">0.5e-6</span><span class="p">,</span> <span class="mf">0.5e-6</span><span class="p">),</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cube&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">GREEN</span><span class="p">,</span>
    <span class="n">material</span><span class="o">=</span><span class="n">Material</span><span class="p">(</span><span class="n">permittivity</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">relative_permittivity_silicon</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">placement_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">cube1</span><span class="o">.</span><span class="n">place_above</span><span class="p">(</span><span class="n">substrate</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">placement_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">cube1</span><span class="o">.</span><span class="n">place_at_center</span><span class="p">(</span>
        <span class="n">substrate</span><span class="p">,</span>
        <span class="n">axes</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">cube2</span> <span class="o">=</span> <span class="n">UniformMaterialObject</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cube2&quot;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="o">.</span><span class="n">MAGENTA</span><span class="p">,</span>
    <span class="n">partial_real_shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">0.5e-6</span><span class="p">,</span> <span class="mf">0.5e-6</span><span class="p">),</span>
    <span class="n">material</span><span class="o">=</span><span class="n">Material</span><span class="p">(</span><span class="n">permittivity</span><span class="o">=</span><span class="n">constants</span><span class="o">.</span><span class="n">relative_permittivity_silicon</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">placement_constraints</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
    <span class="n">cube2</span><span class="o">.</span><span class="n">place_above</span><span class="p">(</span><span class="n">substrate</span><span class="p">),</span>
    <span class="c1"># place at center of y-axis</span>
    <span class="n">cube2</span><span class="o">.</span><span class="n">place_at_center</span><span class="p">(</span>
        <span class="n">cube1</span><span class="p">,</span>
        <span class="n">axes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="c1"># extend object up to first cube</span>
    <span class="n">cube2</span><span class="o">.</span><span class="n">extend_to</span><span class="p">(</span>
        <span class="n">cube1</span><span class="p">,</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">])</span>
</code></pre></div>
<img alt="image" src="../../img/setup_9.png" />
This constrains the size of cube2 such that its upper boundary ("+") extends directly up to cube1 in the x-axis.</p>
<p>See the <a href="../api/objects/index.md">Objects API Reference</a> for complete details on all positioning and sizing options.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../jax_introduction/" class="btn btn-neutral float-left" title="JAX in FDTDX"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../materials/" class="btn btn-neutral float-right" title="Materials Guide">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
      <p>Maintained by Yannik Mahlau</p>
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/ymahlau/fdtdx" class="fa fa-code-fork" style="color: #fcfcfc"> ymahlau/fdtdx</a>
        </span>
    
    
      <span><a href="../jax_introduction/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../materials/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../javascripts/mathjax.js"></script>
      <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
